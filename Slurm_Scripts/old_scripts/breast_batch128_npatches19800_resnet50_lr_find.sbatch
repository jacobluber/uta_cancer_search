#!/bin/bash

#SBATCH --job-name=breast_batch128_npatches19800_resnet50_lr_find
#SBATCH --mail-type=END,FAIL
#SBATCH --mail-user=mohammadsadegh.nasr@uta.edu
#SBATCH --nodes=1
#SBATCH --ntasks-per-node=1
#SBATCH --cpus-per-task=10
#SBATCH --mem=256G
#SBATCH --gres=gpu:1
#SBATCH --time=120:00:00
#SBATCH --error=/home/mxn2498/projects/uta_cancer_search/logs/slurm_logs/breast_batch128_npatches19800_resnet50_lr_find.err
#SBATCH --output=/home/mxn2498/projects/uta_cancer_search/logs/slurm_logs/breast_batch128_npatches19800_resnet50_lr_find.out

function fail {
    echo "FAIL: $@" >&2
    exit 1  # signal failure
}

source /home/mxn2498/miniconda3/etc/profile.d/conda.sh || fail "conda load fail"
conda activate vae || fail "conda activate fail"

cd /home/mxn2498/projects/uta_cancer_search/


python /home/mxn2498/projects/uta_cancer_search/main_gdc_lr_find.py --everything_seed 0 --test_random_seed 1 --train_val_random_seed 2 --pathcing_seed 3 --logging_dir /home/mxn2498/projects/uta_cancer_search/logs/tb_logs --logging_name breast_batch128_latent8_npatches19800_resnet50_lr_find --inv_transformations_read_dir /home/mxn2498/projects/uta_cancer_search/logs/tb_logs/breast_batch128_latent8_npatches19800_resnet50_lr_find --cancer_type Breast --ratio_per_type 1 --split_ratio 0.9 0.05 0.05 --patch_size 64 --num_patches_per_image 40 --num_dataset_workers 8 --coords_read_dir /home/mxn2498/projects/uta_cancer_search/logs/coords/breast_npathces19800 --batch_size 128 --num_dataloader_workers 8 --normalize_transform --input_height 64 --enc_type resnet50 --enc_out_dim 2048 --latent_dim 8 --lr 0.0001 --gradient_clip_val 0.5 --num_nodes 1 --accelerator gpu --devices 1 --max_epochs 1 --auto_lr_find True --benchmark True --fast_dev_run False || fail "python fail"
# python /home/mxn2498/projects/uta_cancer_search/main_gdc_lr_find.py --everything_seed 0 --test_random_seed 1 --train_val_random_seed 2 --pathcing_seed 3 --logging_dir /home/mxn2498/projects/uta_cancer_search/logs/tb_logs --logging_name breast_batch128_latent16_npatches19800_resnet50_lr_find --inv_transformations_read_dir /home/mxn2498/projects/uta_cancer_search/logs/tb_logs/breast_batch128_latent16_npatches19800_resnet50_lr_find --cancer_type Breast --ratio_per_type 1 --split_ratio 0.9 0.05 0.05 --patch_size 64 --num_patches_per_image 40 --num_dataset_workers 8 --coords_read_dir /home/mxn2498/projects/uta_cancer_search/logs/coords/breast_npathces19800 --batch_size 128 --num_dataloader_workers 8 --normalize_transform --input_height 64 --enc_type resnet50 --enc_out_dim 2048 --latent_dim 16 --lr 0.0001 --gradient_clip_val 0.5 --num_nodes 1 --accelerator gpu --devices 1 --max_epochs 1 --auto_lr_find True --benchmark True --fast_dev_run False || fail "python fail"
python /home/mxn2498/projects/uta_cancer_search/main_gdc_lr_find.py --everything_seed 0 --test_random_seed 1 --train_val_random_seed 2 --pathcing_seed 3 --logging_dir /home/mxn2498/projects/uta_cancer_search/logs/tb_logs --logging_name breast_batch128_latent32_npatches19800_resnet50_lr_find --inv_transformations_read_dir /home/mxn2498/projects/uta_cancer_search/logs/tb_logs/breast_batch128_latent32_npatches19800_resnet50_lr_find --cancer_type Breast --ratio_per_type 1 --split_ratio 0.9 0.05 0.05 --patch_size 64 --num_patches_per_image 40 --num_dataset_workers 8 --coords_read_dir /home/mxn2498/projects/uta_cancer_search/logs/coords/breast_npathces19800 --batch_size 128 --num_dataloader_workers 8 --normalize_transform --input_height 64 --enc_type resnet50 --enc_out_dim 2048 --latent_dim 32 --lr 0.0001 --gradient_clip_val 0.5 --num_nodes 1 --accelerator gpu --devices 1 --max_epochs 1 --auto_lr_find True --benchmark True --fast_dev_run False || fail "python fail"
python /home/mxn2498/projects/uta_cancer_search/main_gdc_lr_find.py --everything_seed 0 --test_random_seed 1 --train_val_random_seed 2 --pathcing_seed 3 --logging_dir /home/mxn2498/projects/uta_cancer_search/logs/tb_logs --logging_name breast_batch128_latent64_npatches19800_resnet50_lr_find --inv_transformations_read_dir /home/mxn2498/projects/uta_cancer_search/logs/tb_logs/breast_batch128_latent64_npatches19800_resnet50_lr_find --cancer_type Breast --ratio_per_type 1 --split_ratio 0.9 0.05 0.05 --patch_size 64 --num_patches_per_image 40 --num_dataset_workers 8 --coords_read_dir /home/mxn2498/projects/uta_cancer_search/logs/coords/breast_npathces19800 --batch_size 128 --num_dataloader_workers 8 --normalize_transform --input_height 64 --enc_type resnet50 --enc_out_dim 2048 --latent_dim 64 --lr 0.0001 --gradient_clip_val 0.5 --num_nodes 1 --accelerator gpu --devices 1 --max_epochs 1 --auto_lr_find True --benchmark True --fast_dev_run False || fail "python fail"
python /home/mxn2498/projects/uta_cancer_search/main_gdc_lr_find.py --everything_seed 0 --test_random_seed 1 --train_val_random_seed 2 --pathcing_seed 3 --logging_dir /home/mxn2498/projects/uta_cancer_search/logs/tb_logs --logging_name breast_batch128_latent128_npatches19800_resnet50_lr_find --inv_transformations_read_dir /home/mxn2498/projects/uta_cancer_search/logs/tb_logs/breast_batch128_latent128_npatches19800_resnet50_lr_find --cancer_type Breast --ratio_per_type 1 --split_ratio 0.9 0.05 0.05 --patch_size 64 --num_patches_per_image 40 --num_dataset_workers 8 --coords_read_dir /home/mxn2498/projects/uta_cancer_search/logs/coords/breast_npathces19800 --batch_size 128 --num_dataloader_workers 8 --normalize_transform --input_height 64 --enc_type resnet50 --enc_out_dim 2048 --latent_dim 128 --lr 0.0001 --gradient_clip_val 0.5 --num_nodes 1 --accelerator gpu --devices 1 --max_epochs 1 --auto_lr_find True --benchmark True --fast_dev_run False || fail "python fail"
python /home/mxn2498/projects/uta_cancer_search/main_gdc_lr_find.py --everything_seed 0 --test_random_seed 1 --train_val_random_seed 2 --pathcing_seed 3 --logging_dir /home/mxn2498/projects/uta_cancer_search/logs/tb_logs --logging_name breast_batch128_latent256_npatches19800_resnet50_lr_find --inv_transformations_read_dir /home/mxn2498/projects/uta_cancer_search/logs/tb_logs/breast_batch128_latent256_npatches19800_resnet50_lr_find --cancer_type Breast --ratio_per_type 1 --split_ratio 0.9 0.05 0.05 --patch_size 64 --num_patches_per_image 40 --num_dataset_workers 8 --coords_read_dir /home/mxn2498/projects/uta_cancer_search/logs/coords/breast_npathces19800 --batch_size 128 --num_dataloader_workers 8 --normalize_transform --input_height 64 --enc_type resnet50 --enc_out_dim 2048 --latent_dim 256 --lr 0.0001 --gradient_clip_val 0.5 --num_nodes 1 --accelerator gpu --devices 1 --max_epochs 1 --auto_lr_find True --benchmark True --fast_dev_run False || fail "python fail"
